<div class="a2-header grey lighten-4">
    <div class="usa-grid">
        <div class="usa-width-one-half">
            <h6>
                <a *ngIf="!stepLoading" [routerLink]="['/step', stepId]">
                    <i class="fa fa-angle-left left"></i> 
                    <span class="chip"><b>{{stepId}}</b></span> 
                    <b>{{step.name}}</b>
                </a>
            </h6>
        </div>
        
        <div class="usa-width-one-half right-align">            
            <a class="right usa-button usa-button-secondary" *ngIf="!stepLoading" [routerLink]="['/step', stepId, 'article', article.id]">Cancel edits</a>
        </div>
    </div>
</div>    
<div class="usa-grid">  
    <h2>Edit the <i class="blue-text">{{knowledgeArticle.title}}</i> knowledge article</h2><br/>
    
    <div *ngIf="!loading">
        <form (ngSubmit)="updateKnowledgeArticle()" #f="ngForm" class="usa-form">
            <fieldset>
                <div class="usa-width-one-half">
                    <label for="title">Title</label>
                    <input id="title"
                        type="text"
                        required
                        name="title"
                        [(ngModel)]="knowledgeArticle.title"
                        class="validate" />
                    
                    <!--TODO: Wire up description to db, should be required -->
                    <label for="description">Description</label>
                    <div class="input-field">
                        <textarea id="description" class="materialize-textarea" data-length="250"></textarea>
                    </div>
                </div>
                
                <!--TODO: Wire up to db -->
                <div class="usa-width-one-half">
                    <label for="files">Upload files</label>
                    <div class="file-field input-field">
                      <div class="btn blue">
                        <span>File</span>
                        <input type="file" multiple>
                      </div>
                      <div class="file-path-wrapper">
                        <input class="file-path validate" type="text" placeholder="Upload one or more files">
                      </div>
                    </div>
                </div>
            </fieldset>
            <br><hr/><br>
            <fieldset class="grey lighten-4">
                <div class="usa-grid">
                    <br/>
                    <h3>
                        <!--TODO: Hide when only one content block (one always has to be visible)-->
                        <a class="usa-button usa-button-tertiary right"><i class="fa fa-times"></i> Delete</a>
                        Content block
                    </h3>
                    
                    <!--TODO: Wire up roles, allow for multiple selections-->
                    <label for="role">Viewable by</label>
                    <select id="role" name="role" multiple>
                        <option>System roles imported here</option>
                        <option>System roles imported here</option>
                        <option>System roles imported here</option>
                    </select>

                    <div *ngIf="edit">
                        <!--TODO: Content block shouldn't be required, but you always have one in the form. Additional can be added and removed-->
                        <label for="body">Content</label>
                        <md-editor id="body" name="body" required [(ngModel)]="knowledgeArticle.body" class="validate"></md-editor>              
                    </div>
                    <div *ngIf="!edit">
                        <label>Content</label>
                        <div class="card-panel">
                            <markdown [data]="knowledgeArticle.body"></markdown>
                        </div>
                    </div>
                </div>
            </fieldset>
            <br/>
            <fieldset>
                <button (click)="toggleEdit()" type="button" class="usa-button usa-button-secondary">{{edit ? 'Preview all content blocks' : 'Back to editing mode'}}</button>
                <a class="usa-button usa-button-secondary"><i class="fa fa-plus"></i> Add additional content block</a>
            </fieldset>
            <br><hr/><br>
            
            <!--TODO: remove "draft" status functionality (and this publish checkbox) for now, will add back later? -->
            <input id="published" type="checkbox" name="published" [(ngModel)]="knowledgeArticle.published" />
            <label for="published">Publish?</label>
            
            <input type="hidden" 
                name="workflow_step_id" [(ngModel)]="knowledgeArticle.workflow_step_id" 
                [value]="stepId" />
            <input type="hidden" 
                name="user_id" [(ngModel)]="knowledgeArticle.userId" [value]="authTokenService.currentUserData.id" />
            
            <fieldset>
                <input type="submit" 
                    [disabled]="!(f.valid)" 
                    value="Update knowledge article" 
                    class="usa-button right" />     
                    <a class="right usa-button usa-button-secondary" *ngIf="!stepLoading" [routerLink]="['/step', stepId, 'article', article.id]">Cancel edits</a>
                <br/><br/><br/><br/>
            </fieldset>
        </form>       
    </div>    
</div>